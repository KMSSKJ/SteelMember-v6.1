@{;
    ViewBag.Title = "表单页面";
    Layout = "~/Views/Shared/_PrintForm.cshtml";
}
<script src="~/Content/scripts/plugins/formatMoney/formatMoney.js"></script>
<script>
    var keyValue = request('keyValue');
    //var IsDetails = request('IsDetails');
    var category = request("category");
    $(function () {
        InitialPage();
        GetOrderEntryGrid();
        initControl();
    });
    //初始化页面
    function InitialPage() {

        //$(".bills").height($(window).height() - 88);
        //resize重设(表格、树形)宽高
        $(window).resize(function (e) {
            window.setTimeout(function () {
                $('#gridTable').setGridWidth(($('.gridPanel').width()) - 88);
                $('#gridTable').setGridHeight($(window).height() - 363.5);
                //$(".bills").height($(window).height() - 88);
            }, 200);
            e.stopPropagation();
        });
    }
    //加载明细表
    function GetOrderEntryGrid() {
        var $grid = $('#gridTable');
        ////默认添加30行 空行
        //for (var i = 1; i < 16; i++) {

        //    var rowdata = {
        //        RawMaterialName: '',
        //        RawMaterialModel: '',
        //        UnitId: '',
        //        Quantity: '',
        //        Price: '',
        //        PriceAmount: '',
        //        RawMaterialManufacturer: '',
        //        RawMaterialSupplier: '',
        //        Description: '',
        //    }

        //    $('#gridTable').jqGrid('addRowData', i, rowdata);
        ////默认添加16行 空行
        $grid.append("<tr style='font-weight:bold'><td style='width:35px'>序号</td><td style='width:120px'>材料名称</td><td style='width:120px'>规格/<br/>型号</td><td style='width:70px'>单位</td><td style='width:90px'>数量</td><td style='width:70px'>单价<br/>(元)</td><td style='width:100px'>金额<br/>(元)</td><td style='width:110px'>生产厂家</td><td style='width:140px'>供应商名称</td><td style='width:105px'>备注</td></tr>")
        for (var i = 1; i < 16; i++) {
            $grid.append("<tr><td style='width:35px'>" + i + "</td><td style='width:120px'></td><td style='width:120px'></td><td style='width:70px'></td><td style='width:90px'></td><td style='width:70px'></td><td style='width:100px'></td><td style='width:110px'></td><td style='width:140px'></td><td style='width:105px'></td></tr>")
        }
        $grid.append("<tr><td style='border:1px solid #000;' colspan='7'></td><td style='border:1px solid #000;'colspan='3'></td></tr>")
    }

    //初始化控件
    function initControl() {

        //获取表单
        if (!!keyValue) {
            $.SetForm({
                url: "../../SteelMember/RawMaterialPurchase/GetFormJson1",
                param: { keyValue: keyValue },
                success: function (data) {
                    $("#table1").find("tr:eq(0)").find("td:eq(0)").html(data.entity.PurchaseNumbering);
                    $("#table1").find("tr:eq(0)").find("td:eq(1)").html(data.Category);
                    $("#table1").find("tr:eq(0)").find("td:eq(2)").html(data.DepartmentId);

                    $("#table2").find("tr:eq(0)").find("td:eq(0)").html(data.entity.CreateMan);
                    var ReviewMan;
                    if (data.entity.ReviewMan == null || data.entity.ReviewMan == "") {
                        ReviewMan = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                    } else {
                        ReviewMan = data.entity.ReviewMan;
                    }
                    $("#table2").find("tr:eq(0)").find("td:eq(1)").html(ReviewMan);
                    $("#table2").find("tr:eq(0)").find("td:eq(2)").html(data.entity.CreateTime);

                    //明细
                    var childEntity = data.childEntity;
                    $('#gridTable').find('tr').each(function (i) {
                        var row = childEntity[i - 1];
                        if (row != undefined) {
                            $(this).find('td:eq(1)').html(row.RawMaterialName);
                            $(this).find('td:eq(2)').html(row.RawMaterialModel);
                            $(this).find('td:eq(3)').html(row.UnitId);
                            $(this).find('td:eq(4)').html(row.PurchaseQuantity);
                            $(this).find('td:eq(5)').html(row.Price);
                            $(this).find('td:eq(6)').html(row.Price * row.PurchaseQuantity);
                            $(this).find('td:eq(7)').html(row.RawMaterialManufacturer);
                            $(this).find('td:eq(8)').html(row.RawMaterialSupplier);
                            $(this).find('td:eq(9)').html(row.Description);
                            Conversion(i);
                        }
                    });
                }
            })
        } 
    }
    //订单明细换算+合计
    function Conversion(index) {
        //统计合计
        var TotalQty = 0, TotalPrice = 0.00, TotalPriceAmount = 0.00/*, TotalPlusPrice = 0.00, TotalCESSAmount = 0.00, TotalPlusPriceAmount = 0.00*/;
        $("#gridTable tbody tr").each(function (i) {
            i = i + 1;
            if (i < 15) {
                var PriceAmount = document.getElementById("gridTable").rows[i].cells[6].innerText;
                if (PriceAmount.toString() != "" && PriceAmount.toString() != undefined) {
                    TotalPriceAmount += Number(PriceAmount);
                }
            }
        });

        $("#gridTable").find("tr:eq(16)").find("td:eq(0)").html('合计(大写):&otimes;' + formatMoney(TotalPriceAmount));
        $("#gridTable").find("tr:eq(16)").find("td:eq(1)").html('(小写):' + FormatCurrency(TotalPriceAmount));
    }

    //打印
    function btn_print() {
        $(".bills").jqprint();
    }
    //导出
    function btn_export() {
        location.href = "/CustomerManage/Order/ExportOrderEntry?orderId=" + keyValue;
    }
</script>
<div class="bills">
    <p style="font-size:14pt;padding-bottom:10px;text-align:center">@*<img src="~/Content/images/head/tablelogo.png" style="margin-top: -10px;" />*@ 云南交投建设集团第十工程有限公司</p>
    <p style="font-size:20pt;padding-bottom:15px;font-weight:bold;font-family:华文楷体;text-align:center"> 材料采购单 </p>
    <div>
        <table id="table1" class="form" style="width:100%;">
            <tr>
                <th class="formTitle">
                    单号：
                </th>
                <td class="formValue"colspan="2">
                    @*<input readonly id="PurchaseNumbering" type="text" class="form-control" datacol="yes" err="订单编号" checkexpession="NotNull" value="@ViewBag.PurchaseNumbering" style="width: 100%" />*@
                </td>
                <th class="formTitle" style="text-align:right">
                    工程名称：
                </th>
                <td class="formValue">
                    @*<div id="Category" type="selectTree" class="ui-select" style="width:100%" isvalid="yes" checkexpession="NotNull"></div>*@
                </td>
                <th class="formTitle" style="text-align:right">
                    申请部门：
                </th>
                <td class="formValue" colspan="2">
                    @*<div id="DepartmentId" type="selectTree" class="ui-select" style="width: 100%" isvalid="yes" checkexpession="NotNull"></div>*@
                </td>
            </tr>
        </table>
    </div>

    <div class="gridPanel">
        <table id="gridTable" class="formPrint"></table>
    </div>

    <div>
        <table id="table2" class="form" style="width:100%;">
            <tr>
                <th class="formTitle">
                    申请人：
                </th>
                <td class="formValue">
                    @*<input readonly id="CreateMan" type="text" class="form-control" style="width: 100%" value="@ViewBag.CreateMan" />*@
                </td>
                <th class="formTitle">
                    审核人：
                </th>
                <td class="formValue">
                    @*<input readonly id="ReviewMan" type="text" class="form-control" style="width: 100%" value="@ViewBag.ReviewMan" />*@
                </td>
                <th class="formTitle" style="text-align:right">
                    日期：
                </th>
                <td class="formValue">
                    @*<input id="CreateTime" type="text" class="form-control" style="width: 100%" datacol="yes" err="制单日期" checkexpession="NotNull" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm:ss' })" />*@
                </td>
            </tr>
        </table>
    </div>
</div>
<div id="bottomField">
    <div class="btn-group">
        <a id="lr-print" class="btn btn-default" onclick="btn_print()"><i class="fa fa-print"></i>&nbsp;打印</a>
        @*<a id="lr-export" class="btn btn-default" onclick="btn_export()"><i class="fa fa-sign-out"></i>&nbsp;导出</a>*@
    </div>
    @*<div class="btn-group">
            <a id="lr-prev" class="btn btn-default" onclick="btn_prev()"><i class="fa fa-backward"></i>&nbsp;前单</a>
            <a id="lr-next" class="btn btn-default" onclick="btn_next()"><i class="fa fa-forward"></i>&nbsp;后单</a>
        </div>*@
</div>

@*<style>
        body {
            margin: 0px;
        }

        .bill {
            margin: 5px;
        }

            .bill th {
                text-align: left;
                width: 7%;
                color: #222222;
            }

            .bill td {
                width: 20%;
            }

            .bill tr {
                margin-bottom: 10px;
            }

            .bill input {
                text-align: left;
                border-width: 0px;
                border-bottom: 1px solid #e2dada;
            }

        .bills {
            overflow: hidden;
            border-radius: 0px;
            position: relative;
            background: #FFFFFF;
            border: 0px solid rgb(204, 204, 204);
            box-shadow: none;
            padding: 0px;
        }

        .ui-widget-content {
            border-left: 0px;
            border-right: 0px;
            border-bottom: 0px;
        }
    </style>*@