@{
    ViewBag.Title = "项目信息管理";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<meta name="viewport" content="width=device-width" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="~/Content/scripts/plugins/uploadify/uploadify.css" rel="stylesheet" />
<script src="~/Content/scripts/plugins/uploadify/jquery.uploadify.js"></script>

<script>
    //var SystemConfigurationgId = "b51550ed-5f23-4de6-a509-b534c24ae2e1";
    var data_id = "";
    $(function () {
        GetGrid();
    });

    //加载表格
    function GetGrid() {
        $.ajax({
            url: "/SteelMember/SystemConfiguration/GetFormJson",
            type: "get",
            //data: { KeyValue: SystemConfigurationgId },
            dataType: "json",
            async: false,
            success: function (data) {
                if (data != null) {
                    $("#form1").SetWebControls(data);
                    data_id = data.SystemConfigurationId;
                    document.getElementById("SystemConfigurationId").value = data_id;
                    var filename = data.SystemLogo;
                    if (filename != null) {
                        filename = filename.substring(0, filename.lastIndexOf('.'));//获取文件名称，去除后缀名
                        filename = "../../Resource/Document/NetworkDisk/System/Project/" + filename + "/" + data.SystemLogo;
                        document.getElementById("txImg").src = filename;
                    }
                }
            },
        });
        uploadify(data_id);
    }

    /*上传图片*/
    function uploadify(data_id) {
        if (data_id == null) {
            btn_edit();
        }
        //上传Logo
        $("#Avatar").uploadify({
            uploader: '/SteelMember/MemberLibrary/SubmitUpLoadFile',
            swf: '/Content/scripts/plugins/uploadify/uploadify.swf',
            buttonText: "选择图片",
            height: 24,
            width: 70,
            fileTypeDesc: '支持格式:jpg/gif/jpeg/png/bmp.',
            fileTypeExts: '*.jpg;*.gif;*.jpeg;*.png;*.bmp',//允许的格式
            fileSizeLimit: '3MB',
            formData: {//向uploader指定的后台传递数据
                KeyValue: data_id,
                Img: "Logo",
                //file:"",
            },
            onFallback: function () {
                dialogMsg("您未安装FLASH控件，无法上传！请安装FLASH控件后再试", 0);
            },
            onUploadSuccess: function (file, data, response) {
                if (file.name.indexOf(" ") > 0) {
                    dialogMsg("图片名不能包含空格！", 0);
                    return false;
                }
                document.getElementById("txImg").src = data;
                document.getElementById("SystemLogo").value = file.name;
                document.getElementById("lr-edit").style.display = "none";
                dialogMsg('数据已保存！', 0);
                //parent.window.LoadLogo();
                // top.frames[tabiframeId()].windowload();
            },
        });
    }
     

    //保存
    function btn_edit() {
        if (!$('#form1').Validform()) {
            return false;
        }
        var Logo = document.getElementById("SystemLogo").value;
        if (Logo == "" || Logo == null || Logo == undefined) {
            dialogMsg("图片不能为空！", 0);
            return false;
        }
        var postData = $("#form1").GetWebControls(data_id);
        $.SaveForm({
            url: "/SteelMember/SystemConfiguration/SaveForm",
            param: postData,
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().windowload();
            }
        })
    }

    //删除
    function btn_delete() {
        if (data_id != "") {
            $.RemoveForm({
                url: '/SteelMember/SystemConfiguration/RemoveForm?KeyValue=' + data_id,
                param: { KeyValue: data_id },
                success: function (data) {
                    //$("#gridTable").trigger("reloadGrid");
                }
            })
        } else {
            dialogMsg('请选择需要删除的数据项！', 0);
        }
    }

    //刷新
    function windowload() {
        GetGrid();
    }
</script>
<style>
    .uploadify-queue {
        display: none;
    }
</style>
<div class="ui-layout" id="layout" style="height: 100%; width: 100%;padding-right:15px">
    @*<div class="ui-layout-west">
            <div class="west-Panel">
                <div class="panel-Title">项目信息</div>
                <div id="itemTree"></div>
            </div>
        </div>*@
    <div class="ui-layout-center">
        <div class="center-Panel">
            <div class="titlePanel">
                <div id="div_tools_bar" class="toolbar">
                    <div class="btn-group">
                        <a id="lr-replace" class="btn btn-default" onclick="reload();"><i class="fa fa-refresh"></i>&nbsp;刷新</a>
                        @*<a id="lr-add" class="btn btn-default" onclick="btn_add_edit(0)"><i class="fa fa-plus"></i>&nbsp;新增</a>*@
                        <a id="lr-edit" class="btn btn-default" onclick="btn_edit()"><i class="fa fa-pencil-square-o"></i>&nbsp;保存</a>
                        <a id="lr-delete" class="btn btn-default" onclick="btn_delete()"><i class="fa fa-trash-o"></i>&nbsp;删除</a>
                        <a id="lr-import" class="btn btn-default" onclick="btn_import()"><i class="fa fa-upload"></i>&nbsp;导入</a>
                        <a id="lr-derive" class="btn btn-default" onclick="btn_derive()"><i class="fa fa-trash-o"></i>&nbsp;导出</a>
                    </div>
                    <script>$('.toolbar').authorizeButton()</script>
                </div>
            </div>
            <div class="gridPanel">
                @*<table id="gridTable"></table>*@
                <form id="form1">
                    <div id="table_project">
                        <input id="SystemConfigurationId" type="hidden" />
                        <input id="SystemLogo" type="hidden" />
                        <table class="form">
                            <tr>
                                <td class="formTitle">
                                    系统名称《必填项》
                                </td>
                                <td class="formTitle">
                                   系统Logo《必填项》
                                  
                                </td>
                            </tr>
                            <tr>
                                <td class="formValue">
                                    <textarea id="SystemName" type="text" class="form-control" style="height:90%" isvalid="yes" checkexpession="NotNull"></textarea>
                                    @*<input id="SystemName" type="text" class="form-control" />*@
                                </td>
                                <td class="formValue">
                                   <div id="div_projcet_logo" style="margin:2px;">
                                        <div style="float:left;margin:5px;">
                                            <img id="txImg" name="txImg" src="" style=" height:80%;width:45%" />
                                            <div class="btnAvatar" style="float:right;margin-right:160px; margin-top:60px;"><input id="Avatar" name="Avatar" type="file" class="Avatar required" checkexpession="NotNull" /></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

