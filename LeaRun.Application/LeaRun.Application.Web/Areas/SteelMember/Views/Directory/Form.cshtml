@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script type="text/javascript">
    var parentId = request('parentId');
    var treeId = request('treeId');
    var moduleId = request('moduleId');
    var type = request('type');
    $(function () {
        initControl();
    })
    var dataJson = top.Form.directoryJson;
    //初始化控件
    function initControl() {
        //上级
        $("#ParentId").ComboBoxTree({
            url: "../../SteelMember/Directory/ListToTreeJson",
            param: { moduleButtonJson: JSON.stringify(dataJson) },
            method: "post",
            description: "==请选择==",
            height: "150px"
        });
        if (!!treeId) {
            $.each(dataJson, function (i) {
                var row = dataJson[i];
                if (row.TreeID == treeId) {
                    $("#ParentId").ComboBoxTreeSetValue(row.ParentID);
                    $("#TreeName").val(row.TreeName);
                    //$("#form1").SetWebControls(row);
                }
            });
        } else {

            if (!!parentId) {
                $("#ParentId").ComboBoxTreeSetValue(parentId);
            } else {
                $("#ParentId").ComboBoxTreeSetValue(0);
            }
        }
        $("#ModuleId").val(moduleId);
        if (type.toString() == "edit") {
            $("#TreeId").val(treeId);
        } else {
            $("#TreeId").val("@Guid.NewGuid().ToString()");
        }
    }
    //保存表单
    function AcceptClick(callback) {
        if (!$('#form1').Validform()) {
            return false;
        } else {
            var count = 0;
            $.each(dataJson, function (i) {
                var row = dataJson[i];
                if (row.TreeName == $("#TreeName").val()) {
                    count++;
                }
            });
        }
        if (count > 0) {
            dialogMsg("名称已存在", 0);
            //alert("名称已存在");
        } else {
            var data = $("#form1").GetWebControls(treeId);
            if (data["ParentId"] == "") {
                data["ParentId"] = 0;
            }
            callback(data);
            dialogClose();
        }


    }
</script>
<div style="margin-top: 10px; margin-right: 30px;">
    <input id="TreeId" type="hidden" />
    <input id="ModuleId" type="hidden" />
    <table class="form">
        <tr>
            <th class="formTitle">上级</th>
            <td class="formValue">
                <div id="ParentId" type="selectTree" class="ui-select">
                </div>
            </td>
        </tr>
        <tr>
            <th class="formTitle">名称<font face="宋体">*</font></th>
            <td class="formValue">
                <input id="TreeName" type="text" class="form-control" placeholder="请输入名称" isvalid="yes" checkexpession="NotNull" />
            </td>
        </tr>
        @*<tr>
                <th class="formTitle">排序<font face="宋体">*</font></th>
                <td class="formValue">
                    <input id="SortCode" type="text" class="form-control" placeholder="请输入排序" isvalid="yes" checkexpession="Num" />
                </td>
            </tr>*@
    </table>
</div>

