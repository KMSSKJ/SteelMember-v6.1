
@{;
    ViewBag.Title = "汇总表单页面";
    Layout = "~/Views/Shared/_PrintForm.cshtml";
}

<!--
如果您使用的是高版本jQuery调用下面jQuery迁移辅助插件即可-->
<script src="~/Content/scripts/plugins/jquery-jqprint/jquery-migrate-1.2.1.min.js"></script>

<script>
    var CollarEntityJson = request("CollarEntityJson");
    var CollarJson = request("CollarJson");

    $(function () {
        InitialPage();
        GetCollarEntryGrid();
    });
    //初始化页面
    function InitialPage() {

        //$(".bills").height($(window).height() - 88);
        //resize重设(表格、树形)宽高
        $(window).resize(function (e) {
            window.setTimeout(function () {
                $('#gridTable').setGridWidth(($('.gridPanel').width()));
                $('#gridTable').setGridHeight($(window).height() - 363.5);
            }, 200);
            e.stopPropagation();
        });
    }
    //加载明细表
    function GetCollarEntryGrid() {
        //获取表单
        $.SetForm({
            url: "../../SteelMember/MemberWarehouse/QuantitySummaryInfo",
            param: {
                CollarEntityJson: CollarEntityJson,
                CollarJson: CollarJson
            },
            success: function (data) {

                var $grid = $('#gridTable');
                $grid.append("<tr style='font-weight:bold'><td style='width:35px'>序号</td><td style='width:100px'>构件类型</td><td style='width:100px'>构件名称</td><td style='width:70px'>单位</td><td style='width:90px'>数量</td><td style='width:105px'>备注</td></tr>");

                if (data.childEntity.length < 10) {
                    for (var i = 0; i < 10; i++) {
                        $grid.append("<tr><td style='width:35px'>" + (i + 1) + "</td><td style='width:100px'></td><td style='width:100px'></td><td style='width:70px'></td><td style='width:90px'></td><td style='width:105px'></td></tr>");
                    }
                } else {
                    for (var i = 0; i < data.childEntity.length; i++) {
                        $grid.append("<tr><td style='width:35px'>" + (i + 1) + "</td><td style='width:100px'></td><td style='width:100px'></td><td style='width:70px'></td><td style='width:90px'></td><td style='width:105px'></td></tr>");
                    }
                }

                $("#table1").find("tr:eq(1)").find("td:eq(0)").html(data.entity.CollarEngineering);
                $("#table1").find("tr:eq(2)").find("td:eq(0)").html(data.entity.OrganizeId);
                $("#table1").find("tr:eq(2)").find("td:eq(1)").html(data.entity.Date);
                $("#table1").find("tr:eq(3)").find("td:eq(0)").html(data.entity.ShippingAddress);
                //$("#table1").find("tr:eq(3)").find("td:eq(1)").html(data.entity.ContactPersonTel);

                //明细
                var childEntity = data.childEntity;
                $('#gridTable').find('tr').each(function (j) {
                    var row = childEntity[j - 1];
                    if (row != undefined) {
                        //$(this).find('input[id="MemberWarehouseId➩' + i + '"]').val(row.MemberWarehouseId);
                        //$(this).find('input[id="CollarId➩' + i + '"]').val(row.CollarId);
                        //$(this).find('input[id="CreateTime➩' + i + '"]').val(row.CreateTime);
                        //$(this).find('input[id="MemberNumber➩' + i + '"]').val(row.MemberNumber);
                        //$(this).find('input[id="MemberName➩' + i + '"]').val(row.MemberName);
                        //$(this).find('input[id="Category➩' + i + '"]').val(row.Category);
                        //$(this).find('input[id="UnitId➩' + i + '"]').val(row.UnitId);
                        //$(this).find('input[id="Description➩' + i + '"]').val(row.Description);
                        $(this).find("td:eq(1)").html(row.Category);
                        $(this).find("td:eq(2)").html(row.MemberName);
                        $(this).find("td:eq(3)").html(row.UnitId);
                        $(this).find("td:eq(4)").html(row.MemberNumber);
                        $(this).find("td:eq(5)").html(row.Description);
                    }
                });
            }
        })
    }
    //打印
    function btn_print() {
        //$(".bills").printTable();
        $(".bills").jqprint();
    }
    //导出
    function btn_export() {
        location.href = "/CustomerManage/Order/ExportOrderEntry?orderId=" + keyValue;
    }
</script>

<div class="bills">

    <div style="float:left">
        <div class="printArea">
            <table id="table1" class="form" style="border:0px solid #ccc;">
                <tr>
                    <td align="center" colspan="11">
                        <p style="font-size:14pt;padding-bottom:10px;text-align:center"> 云南交投建设集团第十工程有限公司</p>
                        <p style="font-size:20pt;padding-bottom:15px;text-align:center;font-family: 华文楷体;font-weight:bold;"> 构件月供应量汇总表</p>
                    </td>
                </tr>

                <tr>
                    <th class="formTitle">
                        工&nbsp;&nbsp;&nbsp;&nbsp;程:
                    </th>
                    <td class="formValue" colspan="10"></td>

                </tr>
                <tr>

                    <th class="formTitle">
                        收货单位:
                    </th>
                    <td class="formValue" colspan="5"></td>
                    <th class="formTitle">
                        起止日期:
                    </th>
                    <td class="formValue" colspan="4"></td>
                </tr>

                <tr>
                    <th class="formTitle">
                        收货地址:
                    </th>
                    <td class="formValue" colspan="10"></td>
                    @*<th class="formTitle"></th>
                        <td class="formValue">第&nbsp;&nbsp;&nbsp;页 共&nbsp;&nbsp;&nbsp;页</td>*@
                </tr>
            </table>
        </div>

        <div class="gridPanel">
            <table id="gridTable" class="formPrint"></table>
        </div>

        <div class="printArea">
            <table id="table2" class="form">
                <tr>
                    <th class="formTitle">
                        加工厂负责人:
                    </th>
                    <td class="formValue"></td>
                    <th class="formTitle">
                        收货单位(签章):
                    </th>
                    <td class="formValue"></td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div id="bottomField">
    <div class="btn-group">
        <a id="lr-print" class="btn btn-default" onclick="btn_print()"><i class="fa fa-print"></i>&nbsp;打印</a>
        @*<a id="lr-export" class="btn btn-default" onclick="btn_export()"><i class="fa fa-sign-out"></i>&nbsp;导出</a>*@
    </div>
    @*<div class="btn-group">
            <a id="lr-prev" class="btn btn-default" onclick="btn_prev()"><i class="fa fa-backward"></i>&nbsp;前单</a>
            <a id="lr-next" class="btn btn-default" onclick="btn_next()"><i class="fa fa-forward"></i>&nbsp;后单</a>
        </div>*@
</div>